I"
(function() {
  var popup, search_stores;

  window.markers = [];

  window.divs = [];

  window.map = L.map('mapid').setView([49.7, 15.5], 8);

  $('document').on('turbolinks:load', function() {
    $('.selectize').selectize({
      create: true,
      sortField: 'text'
    });
  });

  L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoibWFydHljYXNoZXciLCJhIjoiY2p3bzBwa2NiMmQyczQ5bzIwenFrbWNmYiJ9.8vHaT7NMz3mszqg9uqu9hw', {
    maxZoom: 18,
    attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, ' + '<a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' + 'Imagery Â© <a href="https://www.mapbox.com/">Mapbox</a>',
    id: 'mapbox.streets'
  }).addTo(map);

  $(function() {
    $('div.rowitem').each(function() {
      return markers[$(this).attr("index")] = L.marker([$(this).attr("latitude"), $(this).attr("longitude")]).addTo(map).bindPopup("<b>" + $(this).attr("name") + "</b><br>" + $(this).attr("address") + "<br>" + $(this).attr("city"));
    });
    return divs.push($(this));
  });

  $(function() {
    return $('div.rowitem').click(function() {
      $('.selected-store').removeClass("selected-store");
      $(this).addClass("selected-store");
      map.setView([$(this).attr("latitude"), $(this).attr("longitude")], 15);
      return window.markers[parseInt($(this).attr("index"))].openPopup();
    });
  });

  search_stores = function(text) {
    if (!!text) {
      text = text.toLowerCase();
      return $('div.rowitem').each(function() {
        var str;
        $(this).addClass("hidden");
        map.removeLayer(markers[$(this).attr("index")]);
        str = $(this).attr("address") + " " + $(this).attr("city") + " " + $(this).attr("name");
        str = str.toLowerCase();
        if (str.includes(text)) {
          $(this).removeClass("hidden");
          return map.addLayer(markers[$(this).attr("index")]);
        }
      });
    } else {
      return $('.hidden').each(function() {
        $(this).removeClass("hidden");
        return map.addLayer(markers[$(this).attr("index")]);
      });
    }
  };

  $(function() {
    return $('i.material-icons').click(function() {
      var text;
      text = $('#search').val();
      return search_stores(text);
    });
  });

  $('#search').on('keyup', function(e) {
    var text;
    text = $('#search').val();
    if (e.keyCode === 13) {
      search_stores(text);
    } else if (!(!!text)) {
      search_stores(text);
    }
  });

  popup = L.popup();

  L.Map.invalidateSize();

}).call(this);
:ET